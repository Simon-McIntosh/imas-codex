# Tool Requirements for Discovery Agents
# Project-level definition - applies to all facilities

version: "1.0"
description: "Required and optional tools for code discovery"

# Required tools - discovery will fail without these
required_tools:
  - name: fd
    min_version: "8.0.0"
    purpose: "Fast file enumeration by extension/pattern"
    install_url: "https://github.com/sharkdp/fd/releases"
    version_command: "fd --version"
    install_notes: |
      Download pre-built binary from releases page.
      Extract to ~/bin/ and ensure PATH includes ~/bin.

  - name: rg
    min_version: "13.0.0"
    purpose: "Fast pattern search across files"
    install_url: "https://github.com/BurntSushi/ripgrep/releases"
    version_command: "rg --version"
    install_notes: |
      Download pre-built binary from releases page.
      Extract to ~/bin/ and ensure PATH includes ~/bin.

# Optional tools - enhance discovery but not required
optional_tools:
  - name: scc
    purpose: "Code complexity and SLOC metrics"
    install_url: "https://github.com/boyter/scc/releases"
    version_command: "scc --version"
    use_cases:
      - "Prioritizing files by complexity"
      - "Estimating processing time"
      - "Language detection"

  - name: tokei
    purpose: "Lines of code by language"
    install_url: "https://github.com/XAMPPRocky/tokei/releases"
    version_command: "tokei --version"
    use_cases:
      - "Quick language breakdown"
      - "Directory size assessment"

  - name: dust
    purpose: "Disk usage visualization"
    install_url: "https://github.com/bootandy/dust/releases"
    version_command: "dust --version"
    use_cases:
      - "Finding large directories"
      - "Storage planning"

# Python requirements (on remote facility)
python_requirements:
  min_version: "3.8"
  preferred_version: "3.9+"
  packages:
    # Required for remote parsing (if implemented)
    - name: tree-sitter
      min_version: "0.20.0"
      optional: true
      purpose: "AST-based code parsing"
    
    # Required for remote embedding (if GPU available)
    - name: sentence-transformers
      optional: true
      purpose: "Local embedding generation"
      requires: ["torch"]

# Installation script generator
install_script_template: |
  #!/bin/bash
  # Auto-generated tool installation script
  # Run on remote facility: bash install_tools.sh
  
  set -euo pipefail
  
  INSTALL_DIR="${HOME}/bin"
  mkdir -p "$INSTALL_DIR"
  
  # Add to PATH if not already
  if [[ ":$PATH:" != *":$INSTALL_DIR:"* ]]; then
    echo 'export PATH="$HOME/bin:$PATH"' >> ~/.bashrc
    export PATH="$HOME/bin:$PATH"
  fi
  
  echo "Installing to $INSTALL_DIR..."
  
  # fd
  if ! command -v fd &> /dev/null; then
    echo "Installing fd..."
    curl -sL https://github.com/sharkdp/fd/releases/download/v10.2.0/fd-v10.2.0-x86_64-unknown-linux-musl.tar.gz | \
      tar xz --strip-components=1 -C "$INSTALL_DIR" fd-v10.2.0-x86_64-unknown-linux-musl/fd
  fi
  
  # ripgrep
  if ! command -v rg &> /dev/null; then
    echo "Installing ripgrep..."
    curl -sL https://github.com/BurntSushi/ripgrep/releases/download/14.1.1/ripgrep-14.1.1-x86_64-unknown-linux-musl.tar.gz | \
      tar xz --strip-components=1 -C "$INSTALL_DIR" ripgrep-14.1.1-x86_64-unknown-linux-musl/rg
  fi
  
  # scc
  if ! command -v scc &> /dev/null; then
    echo "Installing scc..."
    curl -sL https://github.com/boyter/scc/releases/download/v3.4.0/scc_Linux_x86_64.tar.gz | \
      tar xz -C "$INSTALL_DIR" scc
  fi
  
  # tokei
  if ! command -v tokei &> /dev/null; then
    echo "Installing tokei..."
    curl -sL https://github.com/XAMPPRocky/tokei/releases/download/v12.1.2/tokei-x86_64-unknown-linux-musl.tar.gz | \
      tar xz -C "$INSTALL_DIR"
  fi
  
  # dust
  if ! command -v dust &> /dev/null; then
    echo "Installing dust..."
    curl -sL https://github.com/bootandy/dust/releases/download/v1.1.1/dust-v1.1.1-x86_64-unknown-linux-musl.tar.gz | \
      tar xz --strip-components=1 -C "$INSTALL_DIR" dust-v1.1.1-x86_64-unknown-linux-musl/dust
  fi
  
  echo "Done. Installed tools:"
  ls -la "$INSTALL_DIR"
