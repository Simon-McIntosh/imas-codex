# JET - Joint European Torus
#
# Public facility configuration for graph and mappings.
# Infrastructure data is in jet_private.yaml (gitignored).

facility: jet
name: JET (Joint European Torus)
machine: JET
description: Joint European Torus - EUROfusion operated tokamak
location: Culham, United Kingdom

# SSH connection (user configures ~/.ssh/config with this alias)
ssh_host: jet

# Data systems available at this facility
data_systems:
  - ppf    # JET Processed Pulse File system
  - uda    # Universal Data Access (SAL)
  - imas   # IMAS data format
  - mdsplus  # MDSplus (limited use)

# Data source configuration for signal discovery
# Used by: imas-codex discover signals jet
data_sources:
  # PPF is JET's primary processed data system.
  # Organized as Owner/DDA/Dtype. Accessed via SAL REST API, ppfget, or getdat.
  ppf:
    sal_endpoint: https://sal.jet.uk  # SAL REST API
    reference_pulse: 99896
    default_owner: jetppf
    # Exclude DDAs with raw/engineering data (high volume, low physics value)
    exclude_ddas: []

  # IMAS data available post-migration
  imas:
    backends:
      - mdsplus
    db_name: jet

# Data access patterns discovered during facility exploration.
data_access_patterns:
  primary_method: ppf
  shot_identifier: pulse
  signal_naming: >-
    PPF hierarchy: owner/dda/dtype (e.g., jetppf/EFIT/Q95).
    Python PPF API: ppf.ppfdata(pulse, dda, dtype, uid=owner) returns (data, x, t, ier).
    PPF function catalog: ppfget (single signal), ppfdata (full signal with time),
    ppfdda (list DDAs for pulse), ppfdti (list dtypes in DDA), ppfdsq (list sequences),
    ppfgo (open pulse context), ppfuid (set default user), ppfssr (set signal read),
    ppfgsf (get scale factor), pdauth (authenticate write access).
    JPF (raw) access via getdat CLI: getdat <pulse> <system>/<node> (e.g., getdat 99896 da/c2-ipla).
  tree_organization: >-
    PPF by Diagnostic Data Area (DDA): EFIT (equilibrium), KK3 (ECE),
    KG1V (interferometer), BOLO (bolometry), MAGN (magnetics), etc.
    Each DDA contains typed data items (Dtypes) like Q95, TE, NE.
    JPF system provides raw hardware signals organized by system/node path.
  key_tools:
    - ppfget
    - ppfdata
    - ppfdda
    - ppfdti
    - ppfdsq
    - ppfgo
    - ppfuid
    - getdat
    - sal
    - efit
    - jpf
  wiki_signal_patterns:
    - DDA/Dtype catalog tables
    - diagnostic signal listings
    - EFIT equilibrium quantities
    - PPF owner/DDA/Dtype references
    - JPF system/node path tables
    - getdat command examples
  code_import_patterns:
    - from jet.data import sal
    - import ppf
    - ppfget(
    - ppfdata(
    - ppfdda(
    - ppfdti(
    - ppfgo(
    - getdat
    - import sal
    - jet.data.sal
    - ppf.ppfget
    - ppf.ppfdata
  notes:
    - "PPF Python API at /jet/share/DEPOT/pyppf/21260/lib/python/ppf.py - 35+ functions via ctypes to libppf.so"
    - "Key PPF functions: ppfget, ppfdata, ppfdda, ppfdti, ppfdsq, ppfgo, ppfuid, ppfssr, ppfgsf, pdauth"
    - "getdat CLI at /jet/share/bin/getdat - confirmed working: getdat 99896 da/c2-ipla returns plasma current"
    - "JPF system: raw hardware signals, accessed via getdat <pulse> <system>/<node>"
    - "Octave PPF wrappers at /jet/share/DEPOT/OctavePPF/21012/octave/ppf/ (ppfget.m, ppfdda.m, etc.)"
    - "Octave JPF wrappers at /jet/share/DEPOT/OctaveJPF/21024/octave/jpf/ (jpfdat.m, jpfcats.m, jpflist.m)"
    - "libppf.so at /jet/share/lib/libppf.so - native PPF library used by Python/C/Fortran"
    - "UDA modules available (2.6.1 default) but cpyuda Python import fails"
    - "IMAS modules available but import imas fails on default Python"
    - "No SAL REST endpoint responding at sal.jet.uk during SSH exploration"

# Discovery root paths for path discovery pipeline
# These are seeded as starting points for directory scanning
discovery_roots:
  - /home                          # User home directories
  - /work                          # Work area (shared scratch/projects)
  - /common                        # Shared resources
  - /common/IMAS                   # IMAS installation and tools
  - /common/EFDA-CODES             # EUROfusion shared codes
  - /jet/share                     # JET shared codes and tools
  - /jet/share/src                 # JET source code repository

# User info discovery configuration
# GECOS = General Comprehensive Operating System (5th field in /etc/passwd)
user_info:
  name_format: first_last  # Standard "First Last" format
  lookup_tools:  # Ordered fallback list
    - getent   # POSIX standard, includes LDAP/NIS/SSSD
    - passwd   # /etc/passwd fallback
    - id       # existence check only

# Wiki/documentation sites
# JET Data Centre hosts 16 separate MediaWiki instances at wiki.jetdata.eu
# Each is a distinct site for different task forces/groups

# Common defaults for all JET wiki sites
_wiki_defaults: &wiki_defaults
  portal_page: Main_Page
  site_type: mediawiki
  access_method: direct      # Accessible via browser with login
  auth_type: keycloak        # Keycloak OIDC via oauth2-proxy at auth.jetdata.eu
  credential_service: jet
  ssh_available: true        # SSH tunnel also possible via JET host

wiki_sites:
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/pog
    description: Plasma Operations Group - operational procedures and session logs
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/ia
    description: Integrated Analysis - analysis tools and workflows
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/ek
    description: Electron Kinetics
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/open
    description: OpenWiki - general documentation
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/rtmc
    description: Real Time Measurement and Control
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/seed
    description: SeedWiki
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tf
    description: TFWiki - Task Force general
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfd
    description: Task Force D - diagnostics
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfe
    description: Task Force E - exhaust
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfe1
    description: Task Force E1
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfe2
    description: Task Force E2
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfh
    description: Task Force H - heating and current drive
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfm
    description: Task Force M - MHD
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfs1
    description: Task Force S1 - scenario 1
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tfs2
    description: Task Force S2 - scenario 2
  - <<: *wiki_defaults
    url: https://wiki.jetdata.eu/tft
    description: Task Force Transport
