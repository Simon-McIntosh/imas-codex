# TCV Tokamak - Swiss Plasma Center (EPFL)
#
# Public facility configuration for graph and mappings.
# Infrastructure data is in tcv_private.yaml (gitignored).

facility: tcv
name: TCV Tokamak
machine: TCV
description: Swiss Plasma Center - TCV Tokamak at EPFL
location: Lausanne, Switzerland

# SSH connection (user configures ~/.ssh/config with this alias)
ssh_host: tcv

# Data systems available at this facility
data_systems:
  - mdsplus
  - tdi

# Discovery root paths for path discovery pipeline
# These are seeded as starting points for directory scanning
discovery_roots:
  - /home                          # User home directories
  - /home/codes                    # Shared analysis/modeling codes
  - /usr/local/CRPP/tdi            # TDI expression library
  - /usr/local/mdsplus/trees       # MDSplus tree definitions
  - /videoanalysis                 # Video analysis code
  - /videodata                     # Video data

# Data source configuration for signal discovery
# Used by: imas-codex discover signals tcv
data_sources:
  # TDI functions are the primary data access layer for TCV.
  # These .fun files define physics-level accessor functions that abstract
  # over raw MDSplus paths, handle versioning, and provide source selection.
  tdi:
    # Primary TDI directory (scanned for signal discovery)
    primary_path: /usr/local/CRPP/tdi/tcv  # Physics accessors: tcv_eq, tcv_get, tcv_ip
    # Reference shot for TDI accessor validation
    reference_shot: 85000
    # Hardware control and operational functions to exclude from signal discovery.
    # These functions may load missing shared libraries (e.g., libvaccess.so),
    # print debug output to stdout, or perform machine-control actions.
    exclude_functions:
      # Hardware / vacuum / tile thermocouple control
      - tile_store
      - tile_init_action
      - tile_cycle
      - tile_counter
      - tile_status
      # Acquisition / triggering
      - acq_lente_trigger
      - acq_lente_init
      # Beckhoff PLC / hardware state
      - beckhoff_setstate
      - beckhoff_getstate
      # Shot management / sequencing
      - shot_close
      - shot_open
      - shot_init
      # Initialization / action dispatch (void functions)
      - init_action
      - close_action
      - store_action

  # MDSplus configuration (used for data validation, not signal discovery)
  mdsplus:
    connection_tree: tcv_shot  # Default tree for TDI context

# Data access patterns discovered during facility exploration.
# Informs wiki scoring, code ingestion, and signal discovery.
data_access_patterns:
  primary_method: tdi
  shot_identifier: shot
  signal_naming: >-
    TDI function dispatch: tcv_eq('quantity', source='LIUQE'),
    tcv_get('signal_name'), or direct functions like fir_aut(shot).
    Raw MDSplus paths use backslash notation: \tree::subtree:node.
  tree_organization: >-
    MDSplus trees by subsystem: tcv_shot (main), results (analysis),
    magnetics, diagz, base, pcs, xtomo. TDI functions abstract over
    these trees with automatic path resolution.
  key_tools:
    - tdiExecute
    - tcv_get
    - tcv_eq
    - gdat
    - tcvget
  wiki_signal_patterns:
    - MDSplus path tables
    - diagnostic node listings
    - signal catalogs with units
    - TDI function documentation
  code_import_patterns:
    - import MDSplus
    - from MDSplus import
    - tdiExecute
    - tcv_get
    - gdat(

# Wiki/documentation sites
# Direct HTTP access via Tequila SSO (EPFL authentication)
# Set credentials: imas-codex credentials set tcv-wiki
wiki_sites:
  - url: https://spcwiki.epfl.ch/wiki
    portal_page: Portal:TCV
    site_type: mediawiki
    access_method: direct  # Accessible from internet
    auth_type: tequila     # EPFL Tequila SSO
    credential_service: tcv
    ssh_available: true    # SSH tunnel also possible via tcv host

# User info discovery configuration
# GECOS = General Comprehensive Operating System (5th field in /etc/passwd)
user_info:
  name_format: first_last  # Standard "First Last" format
  lookup_tools:  # Ordered fallback list
    - getent   # POSIX standard, includes LDAP/NIS/SSSD
    - passwd   # /etc/passwd fallback
    - id       # existence check only