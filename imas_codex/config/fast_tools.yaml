# Fast CLI Tools Configuration
#
# Canonical list of fast Rust-based CLI tools for code exploration.
# Used by both local development (AGENTS.md) and remote facilities (explore.md).
#
# Tools are installed to ~/bin/ and accessed via:
# - Local: `rg 'pattern'` (when ~/bin is in PATH)
# - Remote: `run('rg "pattern"', facility='tcv')` (auto-detects SSH vs local)
#
# The ReAct installer agent uses this file to install missing tools.
# CLI: uv run imas-codex tools check/install <facility>

# Installation settings
install:
  directory: "~/bin"
  architectures:
    x86_64: "x86_64-unknown-linux-musl"
    aarch64: "aarch64-unknown-linux-musl"

# Required tools - exploration will be degraded without these
required:
  rg:
    name: ripgrep
    purpose: Fast pattern search across files (10x faster than grep)
    binary: rg
    fallback: "grep -r"
    releases:
      repo: BurntSushi/ripgrep
      version: "15.1.0"
      tag_prefix: ""  # ripgrep uses no v prefix
      asset_pattern: "ripgrep-{version}-{arch}.tar.gz"
      strip_components: 1
      binary_path: "ripgrep-{version}-{arch}/rg"
    examples:
      local: "rg 'pattern' -t py"
      remote: "ssh('rg \"pattern\" -t py /home/codes')"

  fd:
    name: fd
    purpose: Fast file finder (5x faster than find)
    binary: fd
    fallback: "find . -name"
    releases:
      repo: sharkdp/fd
      version: "10.3.0"
      asset_pattern: "fd-v{version}-{arch}.tar.gz"
      strip_components: 1
      binary_path: "fd-v{version}-{arch}/fd"
    # CRITICAL: fd requires path as trailing argument, not option
    # Usage: fd [pattern] [path]... - path is REQUIRED for remote/large filesystems
    # Without path, fd searches cwd which may hang or return unexpected results
    examples:
      local: "fd -e py /path/to/search"
      remote: "ssh facility 'fd -e py /path/to/search'"
      pattern: "fd 'pattern' /path"  # pattern first, then path

  git:
    name: git
    purpose: Version control for git metadata extraction in discovery scans
    binary: git
    fallback: null
    # Minimum version for safe.directory=* support (added in 2.35.2)
    min_version: "2.35.2"
    # System-only: no prebuilt binaries available, requires package manager
    # Install via: apt install git, yum install git, or module load git
    system_only: true
    releases: {}
    examples:
      local: "git -C /path rev-parse HEAD"
      remote: "ssh facility 'git -C /path config --get remote.origin.url'"

  gh:
    name: GitHub CLI
    purpose: GitHub API access for repo visibility checking and git operations
    binary: gh
    fallback: null
    releases:
      repo: cli/cli
      version: "2.86.0"
      # gh tarball structure: gh_2.67.0_linux_amd64/bin/gh - need strip 2 to get just 'gh'
      asset_pattern: "gh_{version}_linux_{arch_simple}.tar.gz"
      strip_components: 2
      binary_path: "gh_{version}_linux_{arch_simple}/bin/gh"
      arch_map:
        x86_64: "amd64"
        aarch64: "arm64"
    examples:
      local: "gh api repos/owner/repo"
      remote: "ssh('gh api repos/owner/repo')"

  uv:
    name: uv
    purpose: Fast Python package manager for venv and dependency management
    binary: uv
    fallback: null
    releases:
      repo: astral-sh/uv
      version: "0.9.28"
      tag_prefix: ""  # uv uses no v prefix
      # uv tarball contains uv-{arch}/uv and uv-{arch}/uvx
      # strip_components=1 flattens to ~/bin/uv and ~/bin/uvx
      asset_pattern: "uv-{arch}.tar.gz"
      strip_components: 1
    # Critical for modern Python on remote facilities - enables:
    # - Installing Python versions without root access (uv python install)
    # - Fast venv creation (uv venv)
    # - Dependency management for imas-codex remote components
    examples:
      local: "uv python install 3.12"
      remote: "ssh facility 'uv python install 3.12'"

  eza:
    name: eza
    purpose: Modern ls with tree view for directory hierarchy context
    binary: eza
    fallback: "ls -la"
    releases:
      repo: eza-community/eza
      version: "0.23.4"
      asset_pattern: "eza_{arch}.tar.gz"
      strip_components: 0
      binary_path: "./eza"
    # Used in discovery scanner to provide 2-level tree context for LLM scoring
    # eza --tree --level 2 --only-dirs replaces tree -L 2 -d
    examples:
      local: "eza --tree --level 2 --only-dirs /path"
      remote: "ssh facility 'eza --tree --level 2 --only-dirs /path'"

# Optional tools - enhance exploration but not required
optional:
  tokei:
    name: tokei
    purpose: Lines of code by language
    binary: tokei
    fallback: "wc -l"
    releases:
      repo: XAMPPRocky/tokei
      # tokei v13+ removed binary releases, use 12.1.2
      version: "12.1.2"
      asset_pattern: "tokei-{arch}.tar.gz"
      strip_components: 0
      binary_path: "tokei"
    examples:
      local: "tokei . -o json"
      remote: "ssh('tokei /path -o json')"

  scc:
    name: scc
    purpose: Code complexity and SLOC metrics
    binary: scc
    fallback: null
    releases:
      repo: boyter/scc
      version: "3.6.0"
      # scc uses different naming convention
      asset_pattern: "scc_Linux_{arch_simple}.tar.gz"
      strip_components: 0
      binary_path: "scc"
      arch_map:
        x86_64: "x86_64"
        aarch64: "arm64"
    examples:
      local: "scc . --format json"
      remote: "ssh('scc /path --format json')"

  dust:
    name: dust
    purpose: Visual disk usage analyzer
    binary: dust
    fallback: "du -h --max-depth=2"
    releases:
      repo: bootandy/dust
      version: "1.2.4"
      asset_pattern: "dust-v{version}-{arch}.tar.gz"
      strip_components: 1
      binary_path: "dust-v{version}-{arch}/dust"
    examples:
      local: "dust -d 2 ."
      remote: "ssh('dust -d 2 /path')"



  bat:
    name: bat
    purpose: Syntax-highlighted cat
    binary: bat
    fallback: "cat"
    releases:
      repo: sharkdp/bat
      version: "0.26.1"
      asset_pattern: "bat-v{version}-{arch}.tar.gz"
      strip_components: 1
      binary_path: "bat-v{version}-{arch}/bat"
    examples:
      local: "bat file.py"
      remote: "ssh('bat /path/file.py')"

  delta:
    name: delta
    purpose: Better git diff viewer
    binary: delta
    fallback: "diff"
    releases:
      repo: dandavison/delta
      version: "0.18.2"
      tag_prefix: ""  # delta uses no v prefix
      asset_pattern: "delta-{version}-{arch}.tar.gz"
      strip_components: 1
      binary_path: "delta-{version}-{arch}/delta"
    examples:
      local: "git diff | delta"
      remote: "ssh('git -C /path diff | delta')"

  fzf:
    name: fzf
    purpose: Fuzzy finder for interactive selection
    binary: fzf
    fallback: null
    releases:
      repo: junegunn/fzf
      version: "0.67.0"
      # fzf uses different naming
      asset_pattern: "fzf-{version}-linux_{arch_simple}.tar.gz"
      strip_components: 0
      binary_path: "fzf"
      arch_map:
        x86_64: "amd64"
        aarch64: "arm64"
    examples:
      local: "fd | fzf"
      remote: null  # Interactive, not useful over SSH

  yq:
    name: yq
    purpose: YAML processor (jq for YAML)
    binary: yq
    fallback: null
    releases:
      repo: mikefarah/yq
      version: "4.50.1"
      # yq is a single binary, not tarball
      asset_pattern: "yq_linux_{arch_simple}"
      is_binary: true
      arch_map:
        x86_64: "amd64"
        aarch64: "arm64"
    examples:
      local: "yq '.key' file.yaml"
      remote: "ssh('yq \".key\" /path/file.yaml')"

  jq:
    name: jq
    purpose: JSON processor
    binary: jq
    fallback: null
    releases:
      repo: jqlang/jq
      version: "1.8.1"
      tag_prefix: "jq-"  # jq uses jq- prefix instead of v
      asset_pattern: "jq-linux-{arch_simple}"
      is_binary: true
      arch_map:
        x86_64: "amd64"
        aarch64: "arm64"
    examples:
      local: "jq '.key' file.json"
      remote: "ssh('jq \".key\" /path/file.json')"
